{"cells":[{"cell_type":"markdown","metadata":{"id":"c774U_Tt0DFg"},"source":["**Health-related fakenews detector – Project Work - Machine Learning Group**\n","\n"]},{"cell_type":"markdown","source":["Getting started"],"metadata":{"id":"ITZhiAiC3oI-"}},{"cell_type":"code","execution_count":1,"metadata":{"id":"Tb9Ow9ajxfNl","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1662402117304,"user_tz":-120,"elapsed":3177,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"outputId":"fed7addb-7b7b-44f6-b676-21df7c6b1638"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive', force_remount=True)"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"_SDsILYozBOr","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1662402118381,"user_tz":-120,"elapsed":10,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"outputId":"88274b89-f677-47c1-a6e6-fd7bf98f5a8b"},"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/.shortcut-targets-by-id/1PsQusxcYVwn2YWTsV8t6MtdaehfTA6lh/ColabNotebooks/data\n"]}],"source":["%cd drive/MyDrive/ColabNotebooks/data/"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"opbuqa2KsYhz","executionInfo":{"status":"ok","timestamp":1662402121020,"user_tz":-120,"elapsed":554,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"outputs":[],"source":["#Loading in data as dataframe\n","import pandas as pd\n","import string\n","import numpy as np\n","\n","df = pd.read_csv(\"statements.csv\",index_col=\"Index\")"]},{"cell_type":"code","source":["#Removing punctuation from data frame\n","list_punctuation = ['!', '\"', '#', '$', '%', '&', \"'\", '(', ')', '*', '+', ',', '-', '–', '.', '/', ':', ';', '<', '=', '>', '?', '@', '[', '\\\\', ']', '^', '_', '`', '{', '|', '}', '~', '®', '„', '“', '≥', '≤', '€']\n","def remove_punctuation_df(input):\n","  input = input.replace(\"[^\\w\\s]\",\"\")\n","  input = [\"\".join(letter for letter in word if letter not in string.punctuation)for word in input]\n","  input = [word.translate(string.punctuation) for word in input]\n","  input = [\"\".join(letter for letter in word if letter not in list_punctuation)for word in input]\n","  return input"],"metadata":{"id":"ADqK2KsU1HlO","executionInfo":{"status":"ok","timestamp":1662402123059,"user_tz":-120,"elapsed":398,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":4,"outputs":[]},{"cell_type":"code","source":["df[\"Statement\"] = df[[\"Statement\"]].apply(remove_punctuation_df)"],"metadata":{"id":"QGQ2ajjo0vfK","executionInfo":{"status":"ok","timestamp":1662402123419,"user_tz":-120,"elapsed":366,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":5,"outputs":[]},{"cell_type":"code","source":["#df"],"metadata":{"id":"sDLj2vuy0yMn","executionInfo":{"status":"ok","timestamp":1662402123420,"user_tz":-120,"elapsed":12,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":6,"outputs":[]},{"cell_type":"code","source":["#Removing punctuation from user's sentence\n","other_punctuation = '–®„“≥≤€'\n","our_punctuation = string.punctuation + other_punctuation\n","def remove_punctuation_user(input):\n","  for character in our_punctuation:\n","    input = input.replace(character, '')\n","  return input"],"metadata":{"id":"cVrvotXE0_vP","executionInfo":{"status":"ok","timestamp":1662402123728,"user_tz":-120,"elapsed":4,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":7,"outputs":[]},{"cell_type":"code","source":["example = \"Der COVID-19-Impfstoff Spikevax® von Moderna ist jetzt in Europa für die Anwendung bei Kindern ab 6 Jahren zugelassen worden.\"\n","example = remove_punctuation_user(example)\n","print(example)"],"metadata":{"id":"WnqF57eTEjY0","executionInfo":{"status":"ok","timestamp":1662402125475,"user_tz":-120,"elapsed":491,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"52454ec6-bf1d-4d26-86d7-017fe4a7dfae"},"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["Der COVID19Impfstoff Spikevax von Moderna ist jetzt in Europa für die Anwendung bei Kindern ab 6 Jahren zugelassen worden\n"]}]},{"cell_type":"code","execution_count":9,"metadata":{"id":"MGLSn6TwXoN1","executionInfo":{"status":"ok","timestamp":1662402125820,"user_tz":-120,"elapsed":5,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"outputs":[],"source":["#Setting target variable\n","df_drop = pd.get_dummies(df.iloc[:,0])\n","frames = [df_drop,df[\"True/False\"]]\n","df_final = pd.concat(frames, axis=1)       \n","df_final \n","df_final.tail()  \n","df_target = df[\"True/False\"].eq(1).groupby(df[\"Statement\"]).mean().reset_index()"]},{"cell_type":"code","source":["df_target"],"metadata":{"id":"LKNWHMU72DuT","executionInfo":{"status":"ok","timestamp":1662402126916,"user_tz":-120,"elapsed":20,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/","height":424},"outputId":"4ef54213-fefc-4618-8249-262b4ada7d41"},"execution_count":10,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                             Statement  True/False\n","0     An COVID würden fast nur diejenigen Menschen ...       False\n","1             Azithromycin kann das CovidVirus abtöten       False\n","2     Bleichmittel zu trinken um das Virus im Körpe...       False\n","3               Chloroquin kann das CovidVirus abtöten       False\n","4     Das Virus wurde künstlich hergestellt und die...       False\n","..                                                 ...         ...\n","986       mRNAImpfstoffe können unser Erbgut verändern       False\n","987  mRNAImpfstoffe verändern die DNA im Körper der...       False\n","988  okalreaktionen Schmerzen an der Einstichstelle...        True\n","989  Ähnlich wie bei Erwachsenen ist der Schutz vor...        True\n","990  Österreich war das erste Land in der Europäisc...        True\n","\n","[991 rows x 2 columns]"],"text/html":["\n","  <div id=\"df-729f065a-aef1-4f8a-8939-f3e820c6fdee\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Statement</th>\n","      <th>True/False</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>An COVID würden fast nur diejenigen Menschen ...</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Azithromycin kann das CovidVirus abtöten</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Bleichmittel zu trinken um das Virus im Körpe...</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Chloroquin kann das CovidVirus abtöten</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Das Virus wurde künstlich hergestellt und die...</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>986</th>\n","      <td>mRNAImpfstoffe können unser Erbgut verändern</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>987</th>\n","      <td>mRNAImpfstoffe verändern die DNA im Körper der...</td>\n","      <td>False</td>\n","    </tr>\n","    <tr>\n","      <th>988</th>\n","      <td>okalreaktionen Schmerzen an der Einstichstelle...</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>989</th>\n","      <td>Ähnlich wie bei Erwachsenen ist der Schutz vor...</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>990</th>\n","      <td>Österreich war das erste Land in der Europäisc...</td>\n","      <td>True</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>991 rows × 2 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-729f065a-aef1-4f8a-8939-f3e820c6fdee')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-729f065a-aef1-4f8a-8939-f3e820c6fdee button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-729f065a-aef1-4f8a-8939-f3e820c6fdee');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":10}]},{"cell_type":"markdown","source":["Preprocessing"],"metadata":{"id":"dmTib3PA3dr7"}},{"cell_type":"code","source":["#Preprocessing for dataframe\n","def preprocess_df(input):\n","  input = input.apply(lambda x: x.lower())   #lower case\n","  input = input.apply(lambda x: x.strip())   #remove whitespace left and right\n","  return input"],"metadata":{"id":"BXS0scbzIY4k","executionInfo":{"status":"ok","timestamp":1662402128894,"user_tz":-120,"elapsed":238,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":11,"outputs":[]},{"cell_type":"code","source":["df[\"Statement\"] = df[[\"Statement\"]].apply(preprocess_df)"],"metadata":{"id":"61E6m_6M2hb9","executionInfo":{"status":"ok","timestamp":1662402129380,"user_tz":-120,"elapsed":2,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":12,"outputs":[]},{"cell_type":"code","source":["#df"],"metadata":{"id":"dOA6_wwO2wlZ","executionInfo":{"status":"ok","timestamp":1662402129732,"user_tz":-120,"elapsed":2,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":13,"outputs":[]},{"cell_type":"code","source":["#Preprocessing for user's sentence\n","def preprocess_user(input):\n","  input = input.lower()   #lower case\n","  inout = input.strip()   #remove whitespace left and right\n","  return input"],"metadata":{"id":"I1tkS0_w24jg","executionInfo":{"status":"ok","timestamp":1662402129953,"user_tz":-120,"elapsed":2,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":14,"outputs":[]},{"cell_type":"code","source":["example = preprocess_user(example)\n","print(example)"],"metadata":{"id":"KBH1fKcWIqIL","executionInfo":{"status":"ok","timestamp":1662402130252,"user_tz":-120,"elapsed":6,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"e62be8fa-99a8-4efc-b47b-711df0c7c7f2"},"execution_count":15,"outputs":[{"output_type":"stream","name":"stdout","text":["der covid19impfstoff spikevax von moderna ist jetzt in europa für die anwendung bei kindern ab 6 jahren zugelassen worden\n"]}]},{"cell_type":"code","execution_count":16,"metadata":{"id":"ZIedhq4OBB_t","executionInfo":{"status":"ok","timestamp":1662402131108,"user_tz":-120,"elapsed":860,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"2c7f9b3f-9b67-4da0-b0bb-9e0364e2d845"},"outputs":[{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading package punkt to /root/nltk_data...\n","[nltk_data]   Package punkt is already up-to-date!\n","[nltk_data] Downloading package wordnet to /root/nltk_data...\n","[nltk_data]   Package wordnet is already up-to-date!\n"]},{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":16}],"source":["#Tokenization: bringing sentences into world\n","import nltk\n","nltk.download(\"punkt\")\n","nltk.download(\"wordnet\")"]},{"cell_type":"code","source":["#Tokenization for dataframe\n","def tokenize_df(input):\n","  input = input.apply(lambda x: nltk.word_tokenize(x))\n","  return input"],"metadata":{"id":"G2JXhWol3xhc","executionInfo":{"status":"ok","timestamp":1662402131845,"user_tz":-120,"elapsed":3,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":17,"outputs":[]},{"cell_type":"code","source":["df[\"Statement\"] = df[[\"Statement\"]].apply(tokenize_df)"],"metadata":{"id":"kGcqT5bx3uVC","executionInfo":{"status":"ok","timestamp":1662402132177,"user_tz":-120,"elapsed":4,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":18,"outputs":[]},{"cell_type":"code","source":["#df"],"metadata":{"id":"2vqecZfM4QFl","executionInfo":{"status":"ok","timestamp":1662402132498,"user_tz":-120,"elapsed":2,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":19,"outputs":[]},{"cell_type":"code","source":["#Tokenization for user's sentence\n","def tokenize_user(input):\n","  input = nltk.word_tokenize(input)\n","  return input"],"metadata":{"id":"vEkIG3y130zf","executionInfo":{"status":"ok","timestamp":1662402132828,"user_tz":-120,"elapsed":5,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":20,"outputs":[]},{"cell_type":"code","source":["example = tokenize_user(example)\n","print(example)"],"metadata":{"id":"agUe92i646kV","executionInfo":{"status":"ok","timestamp":1662402133085,"user_tz":-120,"elapsed":12,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"8636f531-1cc1-4a3d-a38c-bf90ee9fe927"},"execution_count":21,"outputs":[{"output_type":"stream","name":"stdout","text":["['der', 'covid19impfstoff', 'spikevax', 'von', 'moderna', 'ist', 'jetzt', 'in', 'europa', 'für', 'die', 'anwendung', 'bei', 'kindern', 'ab', '6', 'jahren', 'zugelassen', 'worden']\n"]}]},{"cell_type":"code","execution_count":22,"metadata":{"id":"QW1gsQiXBDUj","executionInfo":{"status":"ok","timestamp":1662402134832,"user_tz":-120,"elapsed":500,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"c9c744fa-a7f2-40e7-9b43-098cdf0b61ce"},"outputs":[{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading package stopwords to /root/nltk_data...\n","[nltk_data]   Package stopwords is already up-to-date!\n"]},{"output_type":"execute_result","data":{"text/plain":["232"]},"metadata":{},"execution_count":22}],"source":["#Importing the stop words\n","#German stop word library from nltk\n","nltk.download(\"stopwords\")\n","from nltk.corpus import stopwords\n","\n","stopWordsGerman = stopwords.words(\"german\")\n","len(stopWordsGerman)   #232 words"]},{"cell_type":"code","execution_count":23,"metadata":{"id":"K7dV0GtkBzTT","executionInfo":{"status":"ok","timestamp":1662402135177,"user_tz":-120,"elapsed":3,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"outputs":[],"source":["#Removing stop words in dataframe\n","def remove_stopwords_df(input):\n","  input = input.apply(lambda element: [word for word in element if not word in stopWordsGerman])\n","  input = input.apply(lambda x: ' '.join([word for word in x]))   #You can join the list of above words to create a sentence without stop words, as shown below:\n","  return input"]},{"cell_type":"code","source":["df[\"Statement\"] = df[[\"Statement\"]].apply(remove_stopwords_df)"],"metadata":{"id":"xmJHku4T5L9R","executionInfo":{"status":"ok","timestamp":1662402135764,"user_tz":-120,"elapsed":6,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":24,"outputs":[]},{"cell_type":"code","source":["#df"],"metadata":{"id":"I4KwRpA557gn","executionInfo":{"status":"ok","timestamp":1662402137049,"user_tz":-120,"elapsed":367,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":25,"outputs":[]},{"cell_type":"code","source":["#Removing stop words in user's sentence\n","def remove_stopwords_user(input):\n","  new_list = list()\n","  for word in input:\n","    if not word in stopWordsGerman:\n","      new_list.append(word)\n","  sentence_withoutstopwords = ' '.join(new_list)\n","  return sentence_withoutstopwords"],"metadata":{"id":"ZnwBsRod6OPh","executionInfo":{"status":"ok","timestamp":1662402137293,"user_tz":-120,"elapsed":4,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":26,"outputs":[]},{"cell_type":"code","source":["example = remove_stopwords_user(example)\n","print(example)"],"metadata":{"id":"vPkAYtaH_wZa","executionInfo":{"status":"ok","timestamp":1662402137693,"user_tz":-120,"elapsed":12,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"68fb1452-8940-45f1-8f52-a335b0a21df3"},"execution_count":27,"outputs":[{"output_type":"stream","name":"stdout","text":["covid19impfstoff spikevax moderna europa anwendung kindern ab 6 jahren zugelassen worden\n"]}]},{"cell_type":"code","source":["#Saving data after preprocessing part 1 as \"cleanedstatements.csv\"\n","from google.colab import files\n","df.to_csv('cleanedstatements.csv')\n","files.download('cleanedstatements.csv')"],"metadata":{"id":"OUqC9rlYNvTV","executionInfo":{"status":"ok","timestamp":1662402138459,"user_tz":-120,"elapsed":7,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/","height":17},"outputId":"da0907e7-aac9-4db3-ec42-4f7251af2807"},"execution_count":28,"outputs":[{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["\n","    async function download(id, filename, size) {\n","      if (!google.colab.kernel.accessAllowed) {\n","        return;\n","      }\n","      const div = document.createElement('div');\n","      const label = document.createElement('label');\n","      label.textContent = `Downloading \"${filename}\": `;\n","      div.appendChild(label);\n","      const progress = document.createElement('progress');\n","      progress.max = size;\n","      div.appendChild(progress);\n","      document.body.appendChild(div);\n","\n","      const buffers = [];\n","      let downloaded = 0;\n","\n","      const channel = await google.colab.kernel.comms.open(id);\n","      // Send a message to notify the kernel that we're ready.\n","      channel.send({})\n","\n","      for await (const message of channel.messages) {\n","        // Send a message to notify the kernel that we're ready.\n","        channel.send({})\n","        if (message.buffers) {\n","          for (const buffer of message.buffers) {\n","            buffers.push(buffer);\n","            downloaded += buffer.byteLength;\n","            progress.value = downloaded;\n","          }\n","        }\n","      }\n","      const blob = new Blob(buffers, {type: 'application/binary'});\n","      const a = document.createElement('a');\n","      a.href = window.URL.createObjectURL(blob);\n","      a.download = filename;\n","      div.appendChild(a);\n","      a.click();\n","      div.remove();\n","    }\n","  "]},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["download(\"download_43e9f765-63d7-4666-a53d-d3f6f102d94b\", \"cleanedstatements.csv\", 264283)"]},"metadata":{}}]},{"cell_type":"markdown","source":["Lemmatization"],"metadata":{"id":"VhUMifDkZ6t5"}},{"cell_type":"code","execution_count":29,"metadata":{"id":"MNtctxaTsfaF","executionInfo":{"status":"ok","timestamp":1662402154059,"user_tz":-120,"elapsed":14630,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"9aeb4102-1e0d-4bd9-d183-935474a3972e"},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: spacy in /usr/local/lib/python3.7/dist-packages (3.4.1)\n","Requirement already satisfied: srsly<3.0.0,>=2.4.3 in /usr/local/lib/python3.7/dist-packages (from spacy) (2.4.4)\n","Requirement already satisfied: spacy-legacy<3.1.0,>=3.0.9 in /usr/local/lib/python3.7/dist-packages (from spacy) (3.0.10)\n","Requirement already satisfied: thinc<8.2.0,>=8.1.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (8.1.0)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.7/dist-packages (from spacy) (2.11.3)\n","Requirement already satisfied: cymem<2.1.0,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from spacy) (2.0.6)\n","Requirement already satisfied: wasabi<1.1.0,>=0.9.1 in /usr/local/lib/python3.7/dist-packages (from spacy) (0.10.1)\n","Requirement already satisfied: catalogue<2.1.0,>=2.0.6 in /usr/local/lib/python3.7/dist-packages (from spacy) (2.0.8)\n","Requirement already satisfied: murmurhash<1.1.0,>=0.28.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (1.0.8)\n","Requirement already satisfied: pydantic!=1.8,!=1.8.1,<1.10.0,>=1.7.4 in /usr/local/lib/python3.7/dist-packages (from spacy) (1.9.2)\n","Requirement already satisfied: pathy>=0.3.5 in /usr/local/lib/python3.7/dist-packages (from spacy) (0.6.2)\n","Requirement already satisfied: typer<0.5.0,>=0.3.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (0.4.2)\n","Requirement already satisfied: tqdm<5.0.0,>=4.38.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (4.64.0)\n","Requirement already satisfied: spacy-loggers<2.0.0,>=1.0.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (1.0.3)\n","Requirement already satisfied: requests<3.0.0,>=2.13.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (2.23.0)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from spacy) (57.4.0)\n","Requirement already satisfied: langcodes<4.0.0,>=3.2.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (3.3.0)\n","Requirement already satisfied: typing-extensions<4.2.0,>=3.7.4 in /usr/local/lib/python3.7/dist-packages (from spacy) (4.1.1)\n","Requirement already satisfied: preshed<3.1.0,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from spacy) (3.0.7)\n","Requirement already satisfied: numpy>=1.15.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (1.21.6)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.7/dist-packages (from spacy) (21.3)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from catalogue<2.1.0,>=2.0.6->spacy) (3.8.1)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging>=20.0->spacy) (3.0.9)\n","Requirement already satisfied: smart-open<6.0.0,>=5.2.1 in /usr/local/lib/python3.7/dist-packages (from pathy>=0.3.5->spacy) (5.2.1)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy) (3.0.4)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy) (1.24.3)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy) (2022.6.15)\n","Requirement already satisfied: blis<0.8.0,>=0.7.8 in /usr/local/lib/python3.7/dist-packages (from thinc<8.2.0,>=8.1.0->spacy) (0.7.8)\n","Requirement already satisfied: click<9.0.0,>=7.1.1 in /usr/local/lib/python3.7/dist-packages (from typer<0.5.0,>=0.3.0->spacy) (7.1.2)\n","Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from jinja2->spacy) (2.0.1)\n","2022-09-05 18:22:27.402552: E tensorflow/stream_executor/cuda/cuda_driver.cc:271] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting de-core-news-sm==3.4.0\n","  Downloading https://github.com/explosion/spacy-models/releases/download/de_core_news_sm-3.4.0/de_core_news_sm-3.4.0-py3-none-any.whl (14.6 MB)\n","\u001b[K     |████████████████████████████████| 14.6 MB 29.1 MB/s \n","\u001b[?25hRequirement already satisfied: spacy<3.5.0,>=3.4.0 in /usr/local/lib/python3.7/dist-packages (from de-core-news-sm==3.4.0) (3.4.1)\n","Requirement already satisfied: langcodes<4.0.0,>=3.2.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.3.0)\n","Requirement already satisfied: thinc<8.2.0,>=8.1.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (8.1.0)\n","Requirement already satisfied: tqdm<5.0.0,>=4.38.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (4.64.0)\n","Requirement already satisfied: typer<0.5.0,>=0.3.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (0.4.2)\n","Requirement already satisfied: requests<3.0.0,>=2.13.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.23.0)\n","Requirement already satisfied: srsly<3.0.0,>=2.4.3 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.4.4)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (21.3)\n","Requirement already satisfied: typing-extensions<4.2.0,>=3.7.4 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (4.1.1)\n","Requirement already satisfied: wasabi<1.1.0,>=0.9.1 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (0.10.1)\n","Requirement already satisfied: catalogue<2.1.0,>=2.0.6 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.0.8)\n","Requirement already satisfied: numpy>=1.15.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (1.21.6)\n","Requirement already satisfied: pydantic!=1.8,!=1.8.1,<1.10.0,>=1.7.4 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (1.9.2)\n","Requirement already satisfied: spacy-legacy<3.1.0,>=3.0.9 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.0.10)\n","Requirement already satisfied: preshed<3.1.0,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.0.7)\n","Requirement already satisfied: spacy-loggers<2.0.0,>=1.0.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (1.0.3)\n","Requirement already satisfied: cymem<2.1.0,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.0.6)\n","Requirement already satisfied: murmurhash<1.1.0,>=0.28.0 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (1.0.8)\n","Requirement already satisfied: pathy>=0.3.5 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (0.6.2)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (57.4.0)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.7/dist-packages (from spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.11.3)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from catalogue<2.1.0,>=2.0.6->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.8.1)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging>=20.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.0.9)\n","Requirement already satisfied: smart-open<6.0.0,>=5.2.1 in /usr/local/lib/python3.7/dist-packages (from pathy>=0.3.5->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (5.2.1)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2022.6.15)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.10)\n","Requirement already satisfied: blis<0.8.0,>=0.7.8 in /usr/local/lib/python3.7/dist-packages (from thinc<8.2.0,>=8.1.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (0.7.8)\n","Requirement already satisfied: click<9.0.0,>=7.1.1 in /usr/local/lib/python3.7/dist-packages (from typer<0.5.0,>=0.3.0->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (7.1.2)\n","Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from jinja2->spacy<3.5.0,>=3.4.0->de-core-news-sm==3.4.0) (2.0.1)\n","\u001b[38;5;2m✔ Download and installation successful\u001b[0m\n","You can now load the package via spacy.load('de_core_news_sm')\n"]}],"source":["#Lemmatization\n","#Preparation\n","!pip install -U spacy                       #to install spacy-lemmatizer\n","!python -m spacy download de_core_news_sm   #to download the German language module\n","\n","import spacy\n","nlp = spacy.load(\"de_core_news_sm\")\n","\n","nlp.pipe_names   #to define specific lemmas yourself\n","\n","ar = nlp.get_pipe('attribute_ruler')\n","\n","#Phrases related to covid\n","ar.add([[{\"TEXT\":\"vakzinen\"}],[{\"TEXT\":\"vakzine\"}],[{\"TEXT\":\"vaccination\"}],[{\"TEXT\":\"covid19impfung\"}],[{\"TEXT\":\"covidimpfung\"}],[{\"TEXT\":\"covid19schutzimpfung\"}],[{\"TEXT\":\"covidschutzimpfung\"}],[{\"TEXT\":\"coronaschutzimpfung\"}]],{\"LEMMA\":\"impfung\"})\n","ar.add([[{\"TEXT\":\"impfstoffe\"}],[{\"TEXT\":\"impfstoffen\"}]],{\"LEMMA\":\"impfstoff\"})\n","ar.add([[{\"TEXT\":\"covid19\"}],[{\"TEXT\":\"sarscov2\"}]],{\"LEMMA\":\"corona\"})\n","ar.add([[{\"TEXT\":\"coronaerkrankung\"}],[{\"TEXT\":\"coronainfektion\"}],[{\"TEXT\":\"covid19infektion\"}],[{\"TEXT\":\"sarscov2infektion\"}]],{\"LEMMA\":\"corona\"})\n","ar.add([[{\"TEXT\":\"covid19virus\"}],[{\"TEXT\":\"sarscov2virus\"}], [{\"TEXT\":\"coronaviren\"}]], {\"LEMMA\":\"coronavirus\"})\n","ar.add([[{\"TEXT\":\"covid19impfstoff\"}],[{\"TEXT\":\"covidimpfstoffe\"}],[{\"TEXT\":\"covidimpfstoffe\"}]],{\"LEMMA\":\"coronaimpfstoff\"})\n","ar.add([[{\"TEXT\":\"covid19auffrischimpfung\"}],[{\"TEXT\":\"covidauffrischimpfung\"}],[{\"TEXT\":\"coronaauffrischimpfung\"}],[{\"TEXT\":\"auffrischungsimpfung\"}],[{\"TEXT\":\"covid19auffrischungsimpfung\"}],[{\"TEXT\":\"covidiauffrischungsimpfung\"}],[{\"TEXT\":\"coronaauffrischungsimpfung\"}]],{\"LEMMA\":\"auffrischimpfung\"})\n","\n","#Other phrases\n","ar.add([[{\"TEXT\":\"altersgruppe\"}]],{\"LEMMA\":\"altersklasse\"})\n","ar.add([[{\"TEXT\":\"myokarditis\"}],[{\"TEXT\":\"myokarditiden\"}]],{\"LEMMA\":\"herzmuskelentzündung\"})\n","ar.add([[{\"TEXT\":\"todesfälle\"}],[{\"TEXT\":\"sterbefall\"}],[{\"TEXT\":\"sterbefälle\"}],[{\"TEXT\":\"sterberate\"}],[{\"TEXT\":\"todesrate\"}]],{\"LEMMA\":\"todesfall\"})\n","ar.add([[{\"TEXT\":\"fehlgeburten\"}],[{\"TEXT\":\"spontanabort\"}],[{\"TEXT\":\"fehlgeburt\"}],[{\"TEXT\":\"stillgeburt\"}],[{\"TEXT\":\"totgeburt\"}]],{\"LEMMA\":\"fehlgeburt\"})\n"]},{"cell_type":"code","source":["df = pd.read_csv(\"cleanedstatements.csv\", index_col='Index')"],"metadata":{"id":"pkKqckwEJVBA","executionInfo":{"status":"ok","timestamp":1662402162915,"user_tz":-120,"elapsed":229,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":30,"outputs":[]},{"cell_type":"code","source":["def lemmatize_df(input):\n","  lemmtext = []\n","  doc = nlp(input)\n","  input = [x.lemma_ for x in doc]\n","  lemmtext.append(input)\n","  return input"],"metadata":{"id":"fQob3_NIYDdP","executionInfo":{"status":"ok","timestamp":1662402163261,"user_tz":-120,"elapsed":7,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":31,"outputs":[]},{"cell_type":"code","source":["df[\"Statement\"] = df[\"Statement\"].apply(lemmatize_df)\n","df[\"Statement\"] = df[\"Statement\"].apply(lambda x: ' '.join([word for word in x]))\n","df[\"Statement\"] = df[\"Statement\"].apply(lambda x: x.lower())   #Through lemmatization, words with capital letters reappeared, so make everything lower case again"],"metadata":{"id":"83wxcXzmJit7","executionInfo":{"status":"ok","timestamp":1662402172565,"user_tz":-120,"elapsed":9040,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":32,"outputs":[]},{"cell_type":"code","source":["#df"],"metadata":{"id":"yHyeqiAdYjOa","executionInfo":{"status":"ok","timestamp":1662402172567,"user_tz":-120,"elapsed":45,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":33,"outputs":[]},{"cell_type":"code","source":["def lemmatize_user(input):\n","  lemmtext = []\n","  doc = nlp(input)\n","  input = [x.lemma_ for x in doc]\n","  lemmtext.append(input)\n","  lemmatized_sen = ' '.join(input)\n","  lemmatized_sen = lemmatized_sen.lower()   #Through lemmatization, words with capital letters reappeared, so make everything lower case again\n","  return lemmatized_sen"],"metadata":{"id":"Le3lHjK3G4on","executionInfo":{"status":"ok","timestamp":1662402172568,"user_tz":-120,"elapsed":39,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":34,"outputs":[]},{"cell_type":"code","source":["example = lemmatize_user(example)\n","print(example)"],"metadata":{"id":"HyVfB2geIyGY","executionInfo":{"status":"ok","timestamp":1662402172569,"user_tz":-120,"elapsed":35,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"ec7e9b73-f1c9-4397-e14e-aa4014ce0838"},"execution_count":35,"outputs":[{"output_type":"stream","name":"stdout","text":["coronaimpfstoff spikevax moderna europa anwendung kind ab 6 jahr zulassen werden\n"]}]},{"cell_type":"code","source":["#Saving data after lemmatization part 1 as \"lemmatizedstatements.csv\"\n","from google.colab import files\n","df.to_csv('lemmatizedstatements.csv')\n","files.download('lemmatizedstatements.csv')"],"metadata":{"id":"TxpOekzcTuGU","executionInfo":{"status":"ok","timestamp":1662402172570,"user_tz":-120,"elapsed":31,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/","height":17},"outputId":"c704a1f5-fcc0-4b74-fe77-599ca2bfef6c"},"execution_count":36,"outputs":[{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["\n","    async function download(id, filename, size) {\n","      if (!google.colab.kernel.accessAllowed) {\n","        return;\n","      }\n","      const div = document.createElement('div');\n","      const label = document.createElement('label');\n","      label.textContent = `Downloading \"${filename}\": `;\n","      div.appendChild(label);\n","      const progress = document.createElement('progress');\n","      progress.max = size;\n","      div.appendChild(progress);\n","      document.body.appendChild(div);\n","\n","      const buffers = [];\n","      let downloaded = 0;\n","\n","      const channel = await google.colab.kernel.comms.open(id);\n","      // Send a message to notify the kernel that we're ready.\n","      channel.send({})\n","\n","      for await (const message of channel.messages) {\n","        // Send a message to notify the kernel that we're ready.\n","        channel.send({})\n","        if (message.buffers) {\n","          for (const buffer of message.buffers) {\n","            buffers.push(buffer);\n","            downloaded += buffer.byteLength;\n","            progress.value = downloaded;\n","          }\n","        }\n","      }\n","      const blob = new Blob(buffers, {type: 'application/binary'});\n","      const a = document.createElement('a');\n","      a.href = window.URL.createObjectURL(blob);\n","      a.download = filename;\n","      div.appendChild(a);\n","      a.click();\n","      div.remove();\n","    }\n","  "]},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["download(\"download_16a5b17d-9fc0-4321-b7fa-0e86e5f676c4\", \"lemmatizedstatements.csv\", 259289)"]},"metadata":{}}]},{"cell_type":"markdown","source":["Word Cloud"],"metadata":{"id":"7gfb7PBv76eF"}},{"cell_type":"code","execution_count":null,"metadata":{"id":"xW81aXd0bm_R"},"outputs":[],"source":["#Word Cloud\n","#Installing libraries needed\n","!pip install numpy scipy matplotlib ipython jupyter pandas sympy nose wordcloud"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rqU2sN5fciG0"},"outputs":[],"source":["from wordcloud import WordCloud, STOPWORDS \n","import matplotlib.pyplot as plt \n","import pandas as pd\n","\n","#If you want to look at Word Cloud in Colab, the following code is needed\n","!pip install mpld3\n","import mpld3\n","import mpld3\n","from mpld3 import plugins"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"nnJcuzkYfXu8"},"outputs":[],"source":["comment_words = '' \n","from nltk.corpus import stopwords\n","stopset = stopwords.words('german')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"nkS3SQyIhBiE"},"outputs":[],"source":["df = pd.read_csv('lemmatizedstatements.csv')\n","values = df['Statement'].values\n","\n","for val in values: \n","    val = str(val) \n","    tokens = val.split() \n","    for i in range(len(tokens)): \n","        tokens[i] = tokens[i].lower() \n","    comment_words += ' '.join(tokens)+' '"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"aRO47ZVhCKNy"},"outputs":[],"source":["facecolor = 'black'\n","wordcloud = WordCloud(width=1000, height=600, \n","            background_color=facecolor, \n","            stopwords=stopset,\n","            min_font_size=10).generate(comment_words)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"JhAHTYzQCN4_"},"outputs":[],"source":["plt.figure(figsize=(10,6), facecolor=facecolor) \n","plt.imshow(wordcloud) \n","plt.axis('off') \n","plt.tight_layout(pad=2)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TJmNelcaCRNC"},"outputs":[],"source":["#Saving Word Cloud in Colab\n","filename = 'wordcloud'\n","plt.savefig(filename+'.png', facecolor=facecolor)\n","files.download('wordcloud.png')"]},{"cell_type":"markdown","metadata":{"id":"cvqAiB0_7bWB"},"source":["Machine Learning Model: Logistic Regression"]},{"cell_type":"code","source":["#Preparing fake news detector: training model with data"],"metadata":{"id":"Zq2q0fr_BEVl","executionInfo":{"status":"ok","timestamp":1662402188010,"user_tz":-120,"elapsed":224,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":37,"outputs":[]},{"cell_type":"code","execution_count":38,"metadata":{"id":"m25-rr-r7fV_","executionInfo":{"status":"ok","timestamp":1662402188373,"user_tz":-120,"elapsed":14,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"f409658c-8db1-4f28-b082-f420fbe79973"},"outputs":[{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading package stopwords to /root/nltk_data...\n","[nltk_data]   Package stopwords is already up-to-date!\n"]}],"source":["#Following code is from: https://www.kaggle.com/code/shahkan/text-classification-using-logistic-regression/data\n","import re\n","import matplotlib.pyplot as plt\n","from nltk.corpus import stopwords\n","from nltk.stem import PorterStemmer\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.pipeline import Pipeline\n","from sklearn.metrics import classification_report, confusion_matrix\n","from sklearn.model_selection import train_test_split\n","from sklearn.feature_selection import SelectKBest, chi2\n","from sqlite3 import Error\n","from sklearn.ensemble import RandomForestClassifier\n","import sqlite3\n","import pickle\n","import nltk\n","nltk.download('stopwords')\n","%matplotlib inline"]},{"cell_type":"code","source":["dataset = pd.read_csv('lemmatizedstatements.csv')"],"metadata":{"id":"eLgU6INwIKgG","executionInfo":{"status":"ok","timestamp":1662402189169,"user_tz":-120,"elapsed":5,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":39,"outputs":[]},{"cell_type":"code","source":["#Some preprocessing again\n","nltk.download('stopwords')\n","stemmer = PorterStemmer()\n","words = stopwords.words(\"german\")\n","#sowas wie im Folgenden müssen wir auch noch machen: Alle Schritte von oben (Lemmatisierung, Whitespace entfernen etc.) irgendwie in einer neuen Spalte abspeichern, damit wir ein \"cleaned\"-set haben\n","dataset['cleaned'] = dataset['Statement'].apply(lambda x: \" \".join([stemmer.stem(i) for i in re.sub(\"[^a-zA-Z]\", \" \", x).split() if i not in words]).lower())"],"metadata":{"id":"fKySCSKGMOab","executionInfo":{"status":"ok","timestamp":1662402189702,"user_tz":-120,"elapsed":313,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"dac67ac2-6b03-4ab6-8707-ed163801975a"},"execution_count":40,"outputs":[{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading package stopwords to /root/nltk_data...\n","[nltk_data]   Package stopwords is already up-to-date!\n"]}]},{"cell_type":"code","source":["#Stopwords are the same as above\n","vectorizer = TfidfVectorizer(min_df= 3, stop_words=stopWordsGerman, sublinear_tf=True, norm='l2', ngram_range=(1, 2))\n","final_features = vectorizer.fit_transform(dataset['cleaned']).toarray()\n","final_features.shape"],"metadata":{"id":"bUy8C-JzIN7s","executionInfo":{"status":"ok","timestamp":1662402191326,"user_tz":-120,"elapsed":363,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a18cfdcd-59e8-4b50-e14d-ab09566aa688"},"execution_count":41,"outputs":[{"output_type":"execute_result","data":{"text/plain":["(999, 1028)"]},"metadata":{},"execution_count":41}]},{"cell_type":"code","source":["dataset['True/False']"],"metadata":{"id":"2-ikPplIB5Pb","executionInfo":{"status":"ok","timestamp":1662402191566,"user_tz":-120,"elapsed":15,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"88645824-0b45-4d94-9810-355ac1b9c44e"},"execution_count":42,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0       True\n","1       True\n","2       True\n","3       True\n","4       True\n","       ...  \n","994    False\n","995    False\n","996    False\n","997    False\n","998    False\n","Name: True/False, Length: 999, dtype: bool"]},"metadata":{},"execution_count":42}]},{"cell_type":"code","source":["#Alternative Logistic Regression model with code from: https://www.analyticsvidhya.com/blog/2021/04/beginners-guide-to-logistic-regression-using-python/ and': https://www.kaggle.com/code/shahkan/text-classification-using-logistic-regression/notebook\n","\n","from sklearn.linear_model import LogisticRegression\n","X = dataset['cleaned']   #input\n","Y = dataset['True/False']  #output\n","X_train, X_test, y_train, y_test = train_test_split(X, Y, test_size=0.3, random_state=42, stratify=Y)\n","\n","from sklearn.linear_model import LogisticRegression\n","model = LogisticRegression()\n","pipeline = Pipeline([('vect', vectorizer),\n","                     ('chi',  SelectKBest(chi2, k=708)),\n","                     ('clf', LogisticRegression(random_state=42))])\n","model = pipeline.fit(X_train, y_train)\n","predictions = model.predict(X_test)\n","probability = model.predict_proba(X)\n","print(probability)   #left column of matrix: probability of predicted output being 0, right column: probability of predicted output being 1; rows: per each of our statements\n","\n","from sklearn.metrics import classification_report\n","print(classification_report(y_test, predictions))\n","\n","from sklearn.metrics import confusion_matrix\n","print(confusion_matrix(y_test, \n","predictions))"],"metadata":{"id":"uaPVnxqtv3CU","executionInfo":{"status":"ok","timestamp":1662402193567,"user_tz":-120,"elapsed":450,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"d671ccb6-a9ff-49be-9579-62021df38e27"},"execution_count":43,"outputs":[{"output_type":"stream","name":"stdout","text":["[[0.35411062 0.64588938]\n"," [0.36540123 0.63459877]\n"," [0.48442239 0.51557761]\n"," ...\n"," [0.76474238 0.23525762]\n"," [0.69614236 0.30385764]\n"," [0.47927284 0.52072716]]\n","              precision    recall  f1-score   support\n","\n","       False       0.84      0.86      0.85       149\n","        True       0.86      0.84      0.85       151\n","\n","    accuracy                           0.85       300\n","   macro avg       0.85      0.85      0.85       300\n","weighted avg       0.85      0.85      0.85       300\n","\n","[[128  21]\n"," [ 24 127]]\n"]}]},{"cell_type":"code","source":["##one way to improve our model\n","#set parameter C to 10 instead of 0 (by default)\n","# model = LogisticRegression(C=10)\n","#that is to avoid overfitting (model knows data too well)\n","#explanation of parameter C here: https://realpython.com/logistic-regression-python/#regularization\n","#but when I tested, values for accuracy (precision, recall, etc.) were exactly the same (?)"],"metadata":{"id":"vUWE4mWGbv60","executionInfo":{"status":"ok","timestamp":1662402193921,"user_tz":-120,"elapsed":6,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":44,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"rBzq3L-VBHvl"},"source":["Creating Fake News Detector with Anvil"]},{"cell_type":"code","source":["!pip install -Uqq fastai --upgrade\n","!pip install -Uqq fastcore --upgrade\n","!pip install -Uqq pandas==1.1.0\n","!pip install -Uqq anvil-uplink"],"metadata":{"id":"J_qSlX0mqtsd","executionInfo":{"status":"ok","timestamp":1662402208794,"user_tz":-120,"elapsed":12830,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":45,"outputs":[]},{"cell_type":"code","source":["from fastai.text.all import load_learner\n","import anvil.server"],"metadata":{"id":"NBbvURLorJgV","executionInfo":{"status":"ok","timestamp":1662402209119,"user_tz":-120,"elapsed":352,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":46,"outputs":[]},{"cell_type":"code","source":["anvil.server.connect(\"TKEAZQWDWYAZVEHF4EW3TN5F-XGIH7W2J3XZSQW46\")\n","#TKEAZQWDWYAZVEHF4EW3TN5F-XGIH7W2J3XZSQW46 - with logo\n","#N4LVVOIXMFFCGBWSORSS45XN-MVK3UE6YWHZTOI3C"],"metadata":{"id":"g1dBikVQrRfE","executionInfo":{"status":"ok","timestamp":1662402209413,"user_tz":-120,"elapsed":299,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"2fe127c2-b767-46d5-8612-b8b2e3353afc"},"execution_count":47,"outputs":[{"output_type":"stream","name":"stdout","text":["Connecting to wss://anvil.works/uplink\n","Anvil websocket open\n","Connected to \"Default environment\" as SERVER\n"]}]},{"cell_type":"code","source":["##no need to run this again (already in first two cells)\n","##apparently, that's why we get an error\n","\n","#from google.colab import drive\n","#drive.mount('/content/drive')"],"metadata":{"id":"DtlzAI16rZt6"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["##no need to run this again (already in first two cells)\n","##apparently, that's why we get an error\n","\n","#%cd drive/MyDrive/ColabNotebooks/data\n","\n","#MLM-Gruppe_Kopie\n","#ColabNotebooks"],"metadata":{"id":"rrSAvRtPrfhY"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["@anvil.server.callable\n","def predict(input):\n","  input = remove_punctuation_user(input)   #the different kinds of preprocessing steps also have to be applied to our user's input sentence - if not, the machine learning model will not understand the sentence and will not be able to categorize it into True or False\n","  input = preprocess_user(input)\n","  input = tokenize_user(input)\n","  input = remove_stopwords_user(input)\n","  input = lemmatize_user(input)\n","  input = [input]\n","  prediction = model.predict(input)\n","  correct = \"The statement is correct\"\n","  false = \"The statement is false\"\n","  if prediction == 0:\n","    preds = correct\n","  else:\n","    preds = false\n","  return preds\n","\n","          #For demo:\n","          #Correct statement #1: \"Telefonisch, per Mail, online oder ganz ohne Anmeldung – wo und wie Sie die Corona-Schutzimpfung erhalten können, unterscheidet sich je nach Bundesland und Region.\"\n","          #Correct statement #2: \"mRNA-Impfstoffe schützen vor schweren Verläufen.\"\n","          #Correct statement #3: \"Mögliche Nebenwirkungen nach einer Impfung sind Kopfschmerzen oder Schmerzen an der Einstichstelle.\"\n","          #False statement #1: \"mRNA-Impfstoffe verändern die DNA im Körper der geimpften Person.\"\n","          #False statement #2: \"Nach einer Impfung ist der Krankheitsverlauf schwerer als ohne Impfung.\"\n","          #False statement #3: \"Coronaimpfungen verursachen eine Fehlgeburt.\""],"metadata":{"id":"apZieRCXrqbl","executionInfo":{"status":"ok","timestamp":1662402562841,"user_tz":-120,"elapsed":244,"user":{"displayName":"Mona Fromm","userId":"06046541874891914610"}}},"execution_count":52,"outputs":[]},{"cell_type":"code","source":[],"metadata":{"id":"wWiRMU0i_Hxv"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"collapsed_sections":[],"provenance":[{"file_id":"1PGAbVk7VEeNpahcCSfL6hfEe3Y5efh0U","timestamp":1661600899717},{"file_id":"1TAvYzQrfbBXsAyqN7_Mo4R8tAFBWzgi7","timestamp":1659878222333},{"file_id":"1q5UsvHPCcfnZAS9bgOw53dn4-35E0NY5","timestamp":1659558509755}]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}